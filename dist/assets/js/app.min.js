"use strict";

angular.module("app", []);
"use strict";

angular.module("app").constant("env", {
    apiUrl: "http://localhost:8080"
});
'use strict';

angular.module('app').component('footerApp', {
    bindings: {},
    templateUrl: 'common/footer/footer.html',
    controller: function controller() {},
    controllerAs: 'ctrl'
});
'use strict';

angular.module('app').service("CommonService", function ($http, env) {
    var urlBase = env.apiUrl;
    var vm = this;

    vm.getAllColaborators = function () {
        return $http.get(urlBase + '/colaborators');
    };

    vm.createColaborator = function (colaboratorData) {
        console.log('salvar');
        console.log(colaboratorData);
        return $http.post(urlBase + '/colaborators', colaboratorData);
    };

    vm.updateColaborator = function (colaboratorId, colaboratorData) {
        return $http.put(urlBase + '/colaborators/' + colaboratorId, colaboratorData);
    };

    vm.deleteColaborator = function (colaboratorId) {
        return $http.delete(urlBase + '/colaborators/' + colaboratorId);
    };

    vm.getGeneratedPass = function () {
        return $http.get(urlBase + '/colaborators/generate-pass');
    };
});
'use strict';

angular.module('app').component('headerApp', {
    bindings: {
        titleHeader: "="
    },
    templateUrl: 'common/header/header.html',
    controller: function controller() {},
    controllerAs: 'ctrl'
});
"use strict";

angular.module("app").controller("CommonController", ["CommonService", CommonController]);

function CommonController(CommonService) {
  var vm = this;
  vm.titleHeader = "MEDIR SENHAS DOS COLABORADORES";
  vm.formData = {};
  vm.colaborators = [];
  vm.subordinates = [];
  vm.showLeadInput = false;

  vm.submitForm = function () {
    if (vm.formData.lead) {
      vm.addSubordinate(vm.formData);
    } else if (vm.formData.id) {
      vm.updateColaborator(vm.formData.id, vm.formData);
    } else {
      vm.createColaborator(vm.formData);
    }
  };

  vm.generatedPassword = function () {
    CommonService.getGeneratedPass().then(function (response) {
      vm.formData.password = response.data;
    }).catch(function (error) {
      console.log(error);
    });
  };

  vm.toggleSubordinates = function (colaborator) {
    colaborator.showSubordinates = !colaborator.showSubordinates;
  };

  vm.editColaborator = function (colaborator) {
    vm.formData = colaborator;
  };

  vm.addSubordinate = function () {
    var newSubordinate = {
      name: vm.formData.name,
      password: vm.formData.password,
      leadId: vm.formData.leadId,
      id: "SUBORDINATE"
    };

    vm.updateColaborator(newSubordinate.id, newSubordinate);

    vm.showLeadInput = false;
    vm.formData.lead = '';
    vm.formData.leadId = '';
  };

  vm.enableSubordinate = function (colaborator) {
    vm.showLeadInput = true;
    vm.formData.lead = colaborator.name;
    vm.formData.leadId = colaborator.id;
  };

  vm.deleteColaborator = function (colaborator) {
    var index = vm.colaborators.indexOf(colaborator);
    if (index !== -1) {
      vm.colaborators.splice(index, 1);
      CommonService.deleteColaborator(colaborator.id).then(function () {
        vm.getColaborators();
      }).catch(function (error) {
        console.log(error);
      });
    } else {
      var removeColaboratorFromSubordinates = function removeColaboratorFromSubordinates(currentColaborator, colaboratorId) {
        currentColaborator.subordinates = currentColaborator.subordinates.filter(function (subordinate) {
          if (subordinate.id === colaboratorId) {
            return false;
          } else {
            removeColaboratorFromSubordinates(subordinate, colaboratorId);
            return true;
          }
        });
      };

      vm.colaborators.forEach(function (otherColaborator) {
        removeColaboratorFromSubordinates(otherColaborator, colaborator.id);
      });

      vm.colaborators.forEach(function (updatedColaborator) {
        updatedColaborator.subordinateRemoved = colaborator.id;
        console.log(updatedColaborator);
        vm.updateColaborator(updatedColaborator.id, updatedColaborator);
      });
    }
  };

  vm.createColaborator = function (colaboratorData) {
    CommonService.createColaborator(colaboratorData).then(function () {
      vm.getColaborators();
      vm.clearForm();
    }).catch(function (error) {
      console.log(error);
    });
  };

  vm.updateColaborator = function (colaboratorId, colaboratorData) {
    CommonService.updateColaborator(colaboratorId, colaboratorData).then(function () {
      vm.getColaborators();
      vm.clearForm();
    }).catch(function (error) {
      console.log(error);
    });
  };

  vm.clearForm = function () {
    vm.formData = {};
  };

  vm.getColaborators = function () {
    CommonService.getAllColaborators().then(function (response) {
      console.log(response.data);
      vm.colaborators = response.data;
    }).catch(function (error) {
      console.log(error);
    });
  };

  vm.init = function () {
    console.log('init');
    if (vm.colaborators.length === 0) {
      vm.getColaborators();
    }
  };

  vm.init();
}
'use strict';

angular.module('app').component('listColaboratorsApp', {
    bindings: {
        formData: "=",
        showLeadInput: "=",
        colaborators: '<'
    },
    templateUrl: 'components/medidorSenha/allColaborators/listColaborators.html',
    controller: 'CommonController',
    controllerAs: 'ctrl'
});
'use strict';

angular.module('app').component('formApp', {
    bindings: {},
    templateUrl: 'components/medidorSenha/form/form.html',
    controller: 'CommonController',
    controllerAs: 'ctrl'
});
'use strict';

angular.module('app').component('subordinatesApp', {
    bindings: {
        formData: "=",
        showLeadInput: "=",
        subordinates: '<'
    },
    templateUrl: 'components/medidorSenha/allColaborators/subordinates/subordinates.html',
    controller: 'CommonController',
    controllerAs: 'ctrl'
});